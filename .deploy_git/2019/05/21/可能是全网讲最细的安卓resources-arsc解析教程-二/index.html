<!DOCTYPE html>


  <html class="light page-post">


<head>
  <meta charset="utf-8">
  
  <title>可能是全网讲最细的安卓resources.arsc解析教程(二) | LinJW</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="Android,技术相关," />
  

  <meta name="description" content="上篇博客写到,Package资源剩下的部分是由多组RES_TABLE_TYPE_SPEC_TYPE和RES_TABLE_TYPE_TYPE构成的。
一个RES_TABLE_TYPE_SPEC_TYPE后面跟着一个或者多个RES_TABLE_TYPE_TYPE构成一种类型的资源的描述(例如string类型、bool类型、dimen类型等)
RES_TABLE_TYPE_SPEC_TYPE我们接着来看">
<meta property="og:type" content="article">
<meta property="og:title" content="可能是全网讲最细的安卓resources.arsc解析教程(二)">
<meta property="og:url" content="http://139.199.4.241/2019/05/21/可能是全网讲最细的安卓resources-arsc解析教程-二/index.html">
<meta property="og:site_name" content="LinJW">
<meta property="og:description" content="上篇博客写到,Package资源剩下的部分是由多组RES_TABLE_TYPE_SPEC_TYPE和RES_TABLE_TYPE_TYPE构成的。
一个RES_TABLE_TYPE_SPEC_TYPE后面跟着一个或者多个RES_TABLE_TYPE_TYPE构成一种类型的资源的描述(例如string类型、bool类型、dimen类型等)
RES_TABLE_TYPE_SPEC_TYPE我们接着来看">
<meta property="og:image" content="http://139.199.4.241/可能是全网讲最细的安卓resources_arsc解析教程二/1.png">
<meta property="og:image" content="http://139.199.4.241/可能是全网讲最细的安卓resources_arsc解析教程二/2.png">
<meta property="og:updated_time" content="2019-08-27T15:31:18.624Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="可能是全网讲最细的安卓resources.arsc解析教程(二)">
<meta name="twitter:description" content="上篇博客写到,Package资源剩下的部分是由多组RES_TABLE_TYPE_SPEC_TYPE和RES_TABLE_TYPE_TYPE构成的。
一个RES_TABLE_TYPE_SPEC_TYPE后面跟着一个或者多个RES_TABLE_TYPE_TYPE构成一种类型的资源的描述(例如string类型、bool类型、dimen类型等)
RES_TABLE_TYPE_SPEC_TYPE我们接着来看">

  

  
    <link rel="icon" href="/favicon.ico">
  

  <link href="/css/styles.css?v=c114cbe6" rel="stylesheet">


  
    <link rel="stylesheet" href="/css/personal-style.css" type="text/css">
  

  

  
  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?57e94d016e201fba3603a8a2b0263af0";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>


  
  <script type="text/javascript">
	(function(){
	    var bp = document.createElement('script');
	    var curProtocol = window.location.protocol.split(':')[0];
	    if (curProtocol === 'https') {
	        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
	    }
	    else {
	        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
	    }
	    var s = document.getElementsByTagName("script")[0];
	    s.parentNode.insertBefore(bp, s);
	})();
  </script>



  
    <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  

  
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css">
  
</head>

<body>


  
    <span id="toolbox-mobile" class="toolbox-mobile">盒子</span>
  

  <div class="post-header CENTER">
   
  <div class="toolbox">
    <a class="toolbox-entry" href="/">
      <span class="toolbox-entry-text">盒子</span>
      <i class="icon-angle-down"></i>
      <i class="icon-home"></i>
    </a>
    <ul class="list-toolbox">
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/archives/"
            rel="noopener noreferrer"
            target="_self"
            >
            博客
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/tag/"
            rel="noopener noreferrer"
            target="_self"
            >
            标签
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/link/"
            rel="noopener noreferrer"
            target="_self"
            >
            友链
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/about/"
            rel="noopener noreferrer"
            target="_self"
            >
            关于
          </a>
        </li>
      
    </ul>
  </div>


</div>


  <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#RES_TABLE_TYPE_SPEC_TYPE"><span class="toc-text">RES_TABLE_TYPE_SPEC_TYPE</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RES_TABLE_TYPE_TYPE"><span class="toc-text">RES_TABLE_TYPE_TYPE</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ResTable_entry"><span class="toc-text">ResTable_entry</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ResTable_map_entry"><span class="toc-text">ResTable_map_entry</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#u8D44_u6E90_u7684id"><span class="toc-text">资源的id</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ResTable_map"><span class="toc-text">ResTable_map</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Demo"><span class="toc-text">Demo</span></a></li></ol>
  </div>



<div class="content content-post CENTER">
   <article id="post-可能是全网讲最细的安卓resources-arsc解析教程-二" class="article article-type-post" itemprop="blogPost">
  <header class="article-header">
    <h1 class="post-title">可能是全网讲最细的安卓resources.arsc解析教程(二)</h1>

    <div class="article-meta">
      <span>
        <i class="icon-calendar"></i>
        <span>2019.05.21</span>
      </span>

      
        <span class="article-author">
          <i class="icon-user"></i>
          <span>林嘉伟</span>
        </span>
      

      


      
        <span>
          <i class="icon-comment"></i>
          <a href="http://blog.islinjw.cn/2019/05/21/可能是全网讲最细的安卓resources-arsc解析教程-二/#disqus_thread"></a>
        </span>
      

      
      <i class="fa fa-eye"></i> 
        <span id="busuanzi_container_page_pv">
           &nbsp热度 <span id="busuanzi_value_page_pv">
           <i class="fa fa-spinner fa-spin"></i></span>℃
        </span>
      

      
      
    </div>
  </header>

  <div class="article-content">
    
      <p>上篇<a href="http://blog.islinjw.cn/2019/05/18/%E5%8F%AF%E8%83%BD%E6%98%AF%E5%85%A8%E7%BD%91%E8%AE%B2%E6%9C%80%E7%BB%86%E7%9A%84%E5%AE%89%E5%8D%93resources-arsc%E8%A7%A3%E6%9E%90%E6%95%99%E7%A8%8B-%E4%B8%80/" target="_blank" rel="external">博客</a>写到,Package资源剩下的部分是由多组RES_TABLE_TYPE_SPEC_TYPE和RES_TABLE_TYPE_TYPE构成的。</p>
<p>一个RES_TABLE_TYPE_SPEC_TYPE后面跟着一个或者多个RES_TABLE_TYPE_TYPE构成一种类型的资源的描述(例如string类型、bool类型、dimen类型等)</p>
<h1 id="RES_TABLE_TYPE_SPEC_TYPE"><a href="#RES_TABLE_TYPE_SPEC_TYPE" class="headerlink" title="RES_TABLE_TYPE_SPEC_TYPE"></a>RES_TABLE_TYPE_SPEC_TYPE</h1><p>我们接着来看看RES_TABLE_TYPE_SPEC_TYPE的头部结构体:</p>
<figure class="highlight mizar"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * A specification <span class="keyword">of</span> the resources defined <span class="keyword">by</span> a particular type.</span><br><span class="line"> *</span><br><span class="line"> * There should <span class="keyword">be</span> one <span class="keyword">of</span> these chunks <span class="keyword">for</span> each resource type.</span><br><span class="line"> *</span><br><span class="line"> * This structure <span class="keyword">is</span> followed <span class="keyword">by</span> an array <span class="keyword">of</span> integers providing the <span class="keyword">set</span> <span class="keyword">of</span></span><br><span class="line"> * configuration change flags (ResTable_config<span class="comment">::CONFIG_*) that have multiple</span></span><br><span class="line"> * resources <span class="keyword">for</span> <span class="keyword">that</span> configuration.  In addition, the high bit <span class="keyword">is</span> <span class="keyword">set</span> if <span class="keyword">that</span></span><br><span class="line"> * resource has been made public.</span><br><span class="line"> */</span><br><span class="line"><span class="keyword">struct</span> ResTable_typeSpec</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">struct</span> ResChunk_header header;</span><br><span class="line"></span><br><span class="line">    // The type identifier this chunk <span class="keyword">is</span> holding.  Type IDs start</span><br><span class="line">    // at 1 (corresponding to the value <span class="keyword">of</span> the type bits <span class="keyword">in</span> a</span><br><span class="line">    // resource identifier).  0 <span class="keyword">is</span> invalid.</span><br><span class="line">    uint8_t id;</span><br><span class="line"></span><br><span class="line">    // Must <span class="keyword">be</span> 0.</span><br><span class="line">    uint8_t res0;</span><br><span class="line">    // Must <span class="keyword">be</span> 0.</span><br><span class="line">    uint16_t res1;</span><br><span class="line"></span><br><span class="line">    // Number <span class="keyword">of</span> uint32_t entry configuration masks <span class="keyword">that</span> follow.</span><br><span class="line">    uint32_t entryCount;</span><br><span class="line"></span><br><span class="line">    enum &#123;</span><br><span class="line">        // Additional flag indicating an entry <span class="keyword">is</span> public.</span><br><span class="line">        SPEC_PUBLIC = 0x40000000</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>从注释中可以知道ResTable_typeSpec头部后面会跟着entryCount个uint32_t,代表这种类型有entryCount个数据,并且每个uint32_t标识了这个数据在哪些configuration下有特殊的值。</p>
<p>这些configuration可能是不同的地区、不同的屏幕分辨率、不同的sdk版本等:</p>
<figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Flags indicating a set of config values.  These flag constants must</span></span><br><span class="line"><span class="comment">// match the corresponding ones in android.content.pm.ActivityInfo and</span></span><br><span class="line"><span class="comment">// attrs_manifest.xml.</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> &#123;</span></span><br><span class="line"><span class="constant">    CONFIG_MCC</span> = ACONFIGURATION_MCC,</span><br><span class="line"><span class="constant">    CONFIG_MNC</span> = ACONFIGURATION_MCC,</span><br><span class="line"><span class="constant">    CONFIG_LOCALE</span> = ACONFIGURATION_LOCALE,</span><br><span class="line"><span class="constant">    CONFIG_TOUCHSCREEN</span> = ACONFIGURATION_TOUCHSCREEN,</span><br><span class="line"><span class="constant">    CONFIG_KEYBOARD</span> = ACONFIGURATION_KEYBOARD,</span><br><span class="line"><span class="constant">    CONFIG_KEYBOARD_HIDDEN</span> = ACONFIGURATION_KEYBOARD_HIDDEN,</span><br><span class="line"><span class="constant">    CONFIG_NAVIGATION</span> = ACONFIGURATION_NAVIGATION,</span><br><span class="line"><span class="constant">    CONFIG_ORIENTATION</span> = ACONFIGURATION_ORIENTATION,</span><br><span class="line"><span class="constant">    CONFIG_DENSITY</span> = ACONFIGURATION_DENSITY,</span><br><span class="line"><span class="constant">    CONFIG_SCREEN_SIZE</span> = ACONFIGURATION_SCREEN_SIZE,</span><br><span class="line"><span class="constant">    CONFIG_SMALLEST_SCREEN_SIZE</span> = ACONFIGURATION_SMALLEST_SCREEN_SIZE,</span><br><span class="line"><span class="constant">    CONFIG_VERSION</span> = ACONFIGURATION_VERSION,</span><br><span class="line"><span class="constant">    CONFIG_SCREEN_LAYOUT</span> = ACONFIGURATION_SCREEN_LAYOUT,</span><br><span class="line"><span class="constant">    CONFIG_UI_MODE</span> = ACONFIGURATION_UI_MODE,</span><br><span class="line"><span class="constant">    CONFIG_LAYOUTDIR</span> = ACONFIGURATION_LAYOUTDIR,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>这里直接举个例子,例如我们可能会在res/values目录下创建一些bool配置:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">bool</span> name=<span class="string">"abc_action_bar_embed_tabs"</span>&gt;<span class="keyword">true</span>&lt;/<span class="keyword">bool</span>&gt;</span><br><span class="line">&lt;<span class="keyword">bool</span> name=<span class="string">"abc_allow_stacked_button_bar"</span>&gt;<span class="keyword">false</span>&lt;/<span class="keyword">bool</span>&gt;</span><br><span class="line">&lt;<span class="keyword">bool</span> name=<span class="string">"abc_config_actionMenuItemAllCaps"</span>&gt;<span class="keyword">true</span>&lt;/<span class="keyword">bool</span>&gt;</span><br></pre></td></tr></table></figure>
<p>然后可能在竖屏的情况下我们不需要显示action bar,所以在res/values-port目录下我们会把abc_action_bar_embed_tabs的值设置成false</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">bool</span> name=<span class="string">"abc_action_bar_embed_tabs"</span>&gt;<span class="keyword">false</span>&lt;/<span class="keyword">bool</span>&gt;</span><br></pre></td></tr></table></figure>
<p>然后下面代码就能在横屏、竖屏下拿到不同的配置了:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">context</span><span class="class">.getResources</span>()<span class="class">.getBoolean</span>(<span class="tag">R</span><span class="class">.bool</span><span class="class">.abc_action_bar_embed_tabs</span>);</span><br></pre></td></tr></table></figure>
<p>在代码里面,我们可以先读取ResTable_typeSpec,然后根据entryCount得到这种类型有多少个数据(例如这里的bool就有abc_action_bar_embed_tabs、abc_allow_stacked_button_bar、abc_config_actionMenuItemAllCaps三个数据,所以bool类型下的entryCount就是3),然后继续读entryCount个uint32_t,读出来就是每个数据在哪些configuration下有特殊的值。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//printStringFromStringsPool:</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printStringFromStringsPool</span><span class="params">(uint32_t* pOffsets, <span class="keyword">char</span>* pStringsStart, uint32_t stringIndex, uint32_t isUtf8)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//前面两个字节是长度,要跳过</span></span><br><span class="line">    <span class="keyword">char</span>* str = pStringsStart + *(pOffsets + stringIndex) + <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span>(isUtf8) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%s\n"</span>, str);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        printUtf16String((<span class="keyword">char16_t</span>*)str);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//main:</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">ResTable_typeSpec typeSpecHeader;</span><br><span class="line"><span class="keyword">uint32_t</span> config;</span><br><span class="line"><span class="keyword">uint16_t</span> type;</span><br><span class="line"><span class="keyword">while</span>(fread((<span class="keyword">void</span>*)&amp;type, <span class="keyword">sizeof</span>(<span class="keyword">u_int16_t</span>), <span class="number">1</span>, pFile) != <span class="number">0</span>) &#123;</span><br><span class="line">    fseek(pFile, -<span class="keyword">sizeof</span>(<span class="keyword">uint16_t</span>), SEEK_CUR);</span><br><span class="line">    <span class="keyword">if</span>(RES_TABLE_TYPE_SPEC_TYPE == type) &#123;</span><br><span class="line">        fread((<span class="keyword">void</span>*)&amp;typeSpecHeader, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> ResTable_typeSpec), <span class="number">1</span>, pFile);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"type: id=0x%x,name="</span>, typeSpecHeader.id);</span><br><span class="line">        printStringFromStringsPool(</span><br><span class="line">                (<span class="keyword">uint32_t</span>*)pTypeStrings,</span><br><span class="line">                (<span class="keyword">char</span>*)pTypeStrings + typeStringPoolHeader.stringsStart - <span class="keyword">sizeof</span>(<span class="keyword">struct</span> ResStringPool_header),</span><br><span class="line">                typeSpecHeader.id - <span class="number">1</span>,</span><br><span class="line">                typeStringPoolHeader.flags &amp; ResStringPool_header::UTF8_FLAG</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; typeSpecHeader.entryCount ; i++) &#123;</span><br><span class="line">            fread((<span class="keyword">void</span>*)&amp;config, <span class="keyword">sizeof</span>(<span class="keyword">uint32_t</span>), <span class="number">1</span>, pFile);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%x\n"</span>,config);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; </span><br><span class="line">	...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>我们直接找到bool类型下的打印:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">type:id=<span class="number">3</span>,name=<span class="keyword">bool</span></span><br><span class="line"><span class="number">80</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>可以看到bool类型下的确有三个uint32_t,分别是80、0、0。这个80代表的就是CONFIG_ORIENTATION,也就是说这个数据在不同的屏幕方向下面会有和默认值不同的值。而0则代表了这个数据只有一个默认值,不会跟着configuration的变化而改变:</p>
<figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//configuration.h</span></span><br><span class="line"><span class="constant">ACONFIGURATION_ORIENTATION</span> = <span class="number">0</span>x0080,</span><br><span class="line"></span><br><span class="line"><span class="comment">//ResTable_config里面的enum</span></span><br><span class="line"><span class="constant">CONFIG_ORIENTATION</span> = ACONFIGURATION_ORIENTATION,</span><br></pre></td></tr></table></figure>
<p>让我们返回去对比下:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// res/values目录下</span></span><br><span class="line">&lt;<span class="keyword">bool</span> name=<span class="string">"abc_action_bar_embed_tabs"</span>&gt;<span class="keyword">true</span>&lt;/<span class="keyword">bool</span>&gt;</span><br><span class="line">&lt;<span class="keyword">bool</span> name=<span class="string">"abc_allow_stacked_button_bar"</span>&gt;<span class="keyword">false</span>&lt;/<span class="keyword">bool</span>&gt;</span><br><span class="line">&lt;<span class="keyword">bool</span> name=<span class="string">"abc_config_actionMenuItemAllCaps"</span>&gt;<span class="keyword">true</span>&lt;/<span class="keyword">bool</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// res/values-port目录下</span></span><br><span class="line">&lt;<span class="keyword">bool</span> name=<span class="string">"abc_action_bar_embed_tabs"</span>&gt;<span class="keyword">false</span>&lt;/<span class="keyword">bool</span>&gt;</span><br></pre></td></tr></table></figure>
<p>第一个abc_action_bar_embed_tabs在不同的屏幕方向下可能值会改变,所以它的uint32_t值是80,也就是CONFIG_ORIENTATION,而abc_allow_stacked_button_bar 和abc_config_actionMenuItemAllCaps只有默认的配置,所以他们的uint32_t都是0。</p>
<p>所以RES_TABLE_TYPE_SPEC_TYPE的作用就是将数据受到哪些configuration影响都标识出来。</p>
<p>在读取数据的时候先看看它是否会受configuration影响,如果不会,直接读默认的RES_TABLE_TYPE_TYPE里面的默认值就好,否则就根据当前的configuration去到后面对应的RES_TABLE_TYPE_TYPE下面读取对应的值了。</p>
<h1 id="RES_TABLE_TYPE_TYPE"><a href="#RES_TABLE_TYPE_TYPE" class="headerlink" title="RES_TABLE_TYPE_TYPE"></a>RES_TABLE_TYPE_TYPE</h1><p>讲的这里终于到了最重要的部分,我们在xml里面配的值,都会在RES_TABLE_TYPE_TYPE里面体现出来。</p>
<p>我们照例先来看看它的头部结构体:</p>
<figure class="highlight mizar"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * A collection <span class="keyword">of</span> resource entries <span class="keyword">for</span> a particular resource data</span><br><span class="line"> * type. Followed <span class="keyword">by</span> an array <span class="keyword">of</span> uint32_t defining the resource</span><br><span class="line"> * values, corresponding to the array <span class="keyword">of</span> type strings <span class="keyword">in</span> the</span><br><span class="line"> * ResTable_package<span class="comment">::typeStrings string block. Each of these hold an</span></span><br><span class="line"> * index <span class="keyword">from</span> entriesStart; a value <span class="keyword">of</span> NO_ENTRY <span class="keyword">means</span> <span class="keyword">that</span> entry <span class="keyword">is</span></span><br><span class="line"> * <span class="keyword">not</span> defined.</span><br><span class="line"> *</span><br><span class="line"> * There may <span class="keyword">be</span> multiple <span class="keyword">of</span> these chunks <span class="keyword">for</span> a particular resource type,</span><br><span class="line"> * supply different configuration variations <span class="keyword">for</span> the resource values <span class="keyword">of</span></span><br><span class="line"> * <span class="keyword">that</span> type.</span><br><span class="line"> *</span><br><span class="line"> * It would <span class="keyword">be</span> nice to have an additional ordered index <span class="keyword">of</span> entries, so</span><br><span class="line"> * we can do a binary search if trying to find a resource <span class="keyword">by</span> string name.</span><br><span class="line"> */</span><br><span class="line"><span class="keyword">struct</span> ResTable_type</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">struct</span> ResChunk_header header;</span><br><span class="line"></span><br><span class="line">    enum &#123;</span><br><span class="line">        NO_ENTRY = 0xFFFFFFFF</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    // The type identifier this chunk <span class="keyword">is</span> holding.  Type IDs start</span><br><span class="line">    // at 1 (corresponding to the value <span class="keyword">of</span> the type bits <span class="keyword">in</span> a</span><br><span class="line">    // resource identifier).  0 <span class="keyword">is</span> invalid.</span><br><span class="line">    uint8_t id;</span><br><span class="line"></span><br><span class="line">    // Must <span class="keyword">be</span> 0.</span><br><span class="line">    uint8_t res0;</span><br><span class="line">    // Must <span class="keyword">be</span> 0.</span><br><span class="line">    uint16_t res1;</span><br><span class="line"></span><br><span class="line">    // Number <span class="keyword">of</span> uint32_t entry indices <span class="keyword">that</span> follow.</span><br><span class="line">    uint32_t entryCount;</span><br><span class="line"></span><br><span class="line">    // Offset <span class="keyword">from</span> header where ResTable_entry data starts.</span><br><span class="line">    uint32_t entriesStart;</span><br><span class="line"></span><br><span class="line">    ResTable_config config;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>这个ResTable_type里有个config成员,它就是具体的配置了,我们可以把它打印出来:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(RES_TABLE_TYPE_TYPE == <span class="built_in">type</span>) &#123;</span><br><span class="line">    fread((void*)&amp;<span class="built_in">type</span>Header, sizeof(struct ResTable_<span class="built_in">type</span>), <span class="number">1</span>, pFile);</span><br><span class="line">    <span class="built_in">print</span>Config(<span class="built_in">type</span>Header.config);</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>找到bool的那一段,可以看到它有两个RES_TABLE_TYPE_TYPE,第一个是默认的配置(values目录),第二个是port下的配置(values-port目录):</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">type: id=<span class="number">0x3</span>,name=<span class="keyword">bool</span></span><br><span class="line"><span class="number">80</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line">config : </span><br><span class="line">config : port</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>然后根据注释的说明我们知道,ResTable_type头部后跟着entryCount个uint32_t,代表了每个entry相对entriesStart的偏移。这里和RES_STRING_POOL_TYPE有点像,也是从偏移数组读取数据的偏移值,然后从entriesStart进行偏移得到数据的地址。</p>
<img src="/可能是全网讲最细的安卓resources_arsc解析教程二/1.png">
<p>那entriesStart后面的entry是什么呢？其实entry有两种类型ResTable_entry和ResTable_map_entry。</p>
<p>他们其实是有继承关系的,ResTable_map_entry是ResTable_entry的子类(这里的继承关系是c++里面的继承关系,前面我们都是用c语言去讲的,但是这里必须引入c++了,不过也是最基础的继承而已,大家可以自行搜索下)。</p>
<figure class="highlight mizar"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * This <span class="keyword">is</span> the beginning <span class="keyword">of</span> information about an entry <span class="keyword">in</span> the resource</span><br><span class="line"> * table.  It <span class="keyword">holds</span> the reference to the name <span class="keyword">of</span> this entry, <span class="keyword">and</span> <span class="keyword">is</span></span><br><span class="line"> * immediately followed <span class="keyword">by</span> one <span class="keyword">of</span>:</span><br><span class="line"> *   * A Res_value structure, if FLAG_COMPLEX <span class="keyword">is</span> -<span class="keyword">not</span>- <span class="keyword">set</span>.</span><br><span class="line"> *   * An array <span class="keyword">of</span> ResTable_map structures, if FLAG_COMPLEX <span class="keyword">is</span> <span class="keyword">set</span>.</span><br><span class="line"> *     These supply a <span class="keyword">set</span> <span class="keyword">of</span> name/value mappings <span class="keyword">of</span> data.</span><br><span class="line"> */</span><br><span class="line"><span class="keyword">struct</span> ResTable_entry</span><br><span class="line">&#123;</span><br><span class="line">    // Number <span class="keyword">of</span> bytes <span class="keyword">in</span> this structure.</span><br><span class="line">    uint16_t size;</span><br><span class="line"></span><br><span class="line">    enum &#123;</span><br><span class="line">        // If <span class="keyword">set</span>, this <span class="keyword">is</span> a complex entry, holding a <span class="keyword">set</span> <span class="keyword">of</span> name/value</span><br><span class="line">        // mappings.  It <span class="keyword">is</span> followed <span class="keyword">by</span> an array <span class="keyword">of</span> ResTable_map structures.</span><br><span class="line">        FLAG_COMPLEX = 0x0001,</span><br><span class="line">        // If <span class="keyword">set</span>, this resource has been declared public, so libraries</span><br><span class="line">        // are allowed to reference it.</span><br><span class="line">        FLAG_PUBLIC = 0x0002,</span><br><span class="line">        // If <span class="keyword">set</span>, this <span class="keyword">is</span> a weak resource <span class="keyword">and</span> may <span class="keyword">be</span> overriden <span class="keyword">by</span> strong</span><br><span class="line">        // resources <span class="keyword">of</span> the same name/type. This <span class="keyword">is</span> only useful during</span><br><span class="line">        // linking with other resource tables.</span><br><span class="line">        FLAG_WEAK = 0x0004</span><br><span class="line">    &#125;;</span><br><span class="line">    uint16_t flags;</span><br><span class="line"></span><br><span class="line">    // Reference into ResTable_package<span class="comment">::keyStrings identifying this entry.</span></span><br><span class="line">    <span class="keyword">struct</span> ResStringPool_ref key;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Extended form <span class="keyword">of</span> a ResTable_entry <span class="keyword">for</span> map entries, defining a parent map</span><br><span class="line"> * resource <span class="keyword">from</span> which to inherit values.</span><br><span class="line"> */</span><br><span class="line"><span class="keyword">struct</span> ResTable_map_entry : public ResTable_entry</span><br><span class="line">&#123;</span><br><span class="line">    // Resource identifier <span class="keyword">of</span> the parent mapping, <span class="keyword">or</span> 0 if there <span class="keyword">is</span> none.</span><br><span class="line">    ResTable_ref parent;</span><br><span class="line">    // Number <span class="keyword">of</span> name/value pairs <span class="keyword">that</span> follow <span class="keyword">for</span> FLAG_COMPLEX.</span><br><span class="line">    uint32_t count;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>看到注释我们可以知道, ResTable_entry有个flags成员变量,如果它的FLAG_COMPLEX位被置1(也就是说flags &amp; 0x0001 != 0),则它是个ResTable_map_entry结构。</p>
<p>两种结构的不同之处在于ResTable_entry后面跟着的是一个Res_value,而ResTable_map_entry后面跟着的是多个name/value键值对,这个键值对是用struct ResTable_map来表示的。</p>
<h2 id="ResTable_entry"><a href="#ResTable_entry" class="headerlink" title="ResTable_entry"></a>ResTable_entry</h2><p>我们先从ResTable_entry讲起,我们读完struct ResTable_type头部信息之后继续将offset数组和entriesStart开始到剩下的部分都读进去保存到pOffset和pData中。</p>
<p>接着就可以用*(pOffsets + i)得到每个entry的偏移,再与entriesStart相加得到entry的具体位置。这里有一点需要注意的是如果offset是ResTable_type::NO_ENTRY,也就是0xFFFFFFFF的时候,代表它是无效的,直接跳过即可:</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(RES_TABLE_TYPE_TYPE == type) &#123;</span><br><span class="line">    fread((<span class="keyword">void</span>*)&amp;typeHeader, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> ResTable_type), <span class="number">1</span>, pFile);</span><br><span class="line">    printConfig(typeHeader<span class="variable">.config</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 实际struct ResTable_type的大小可能不同sdk版本不一样,所以typeHeader.header.headerSize才是真正的头部大小</span></span><br><span class="line">    fseek(pFile, typeHeader<span class="variable">.header</span><span class="variable">.headerSize</span> -  <span class="keyword">sizeof</span>(<span class="keyword">struct</span> ResTable_type), SEEK_CUR);;</span><br><span class="line"></span><br><span class="line">    uint32_t* pOffsets = (uint32_t*)malloc(typeHeader<span class="variable">.entryCount</span> * <span class="keyword">sizeof</span>(uint32_t));</span><br><span class="line">    fread((<span class="keyword">void</span>*)pOffsets, <span class="keyword">sizeof</span>(uint32_t), typeHeader<span class="variable">.entryCount</span>, pFile);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span>* pData = (<span class="keyword">unsigned</span> <span class="keyword">char</span>*)malloc(typeHeader<span class="variable">.header</span><span class="variable">.size</span> - typeHeader<span class="variable">.entriesStart</span>);</span><br><span class="line">    fread((<span class="keyword">void</span>*)pData, typeHeader<span class="variable">.header</span><span class="variable">.size</span> - typeHeader<span class="variable">.entriesStart</span>, <span class="number">1</span>, pFile);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span> ; i&lt; typeHeader<span class="variable">.entryCount</span> ; i++) &#123;</span><br><span class="line">        uint32_t offset = *(pOffsets + i);</span><br><span class="line">        <span class="keyword">if</span>(offset == ResTable_type::NO_ENTRY) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">struct</span> ResTable_entry* pEntry = (<span class="keyword">struct</span> ResTable_entry*)(pData + offset);</span><br><span class="line">        printf(<span class="string">"entryIndex: 0x%x, key :\n"</span>, i);</span><br><span class="line">        printStringFromStringsPool(</span><br><span class="line">            (uint32_t*)pKeyStrings,</span><br><span class="line">            (<span class="keyword">char</span>*)pKeyStrings + keyStringPoolHeader<span class="variable">.stringsStart</span> - <span class="keyword">sizeof</span>(<span class="keyword">struct</span> ResStringPool_header),</span><br><span class="line">            pEntry-&gt;key<span class="variable">.index</span>,</span><br><span class="line">            keyStringPoolHeader<span class="variable">.flags</span> &amp; ResStringPool_header::UTF8_FLAG</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">if</span>(pEntry-&gt;flags &amp; ResTable_entry::FLAG_CO<span class="built_in">MPLEX</span>) &#123;</span><br><span class="line">           ...</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">struct</span> Res_value* pValue = (<span class="keyword">struct</span> Res_value*)((<span class="keyword">unsigned</span> <span class="keyword">char</span>*)pEntry + <span class="keyword">sizeof</span>(<span class="keyword">struct</span> ResTable_entry));</span><br><span class="line">            printf(<span class="string">"value :\n"</span>);</span><br><span class="line">            printValue(pValue, globalStringPoolHeader, pGlobalStrings);</span><br><span class="line">            printf(<span class="string">"\n"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    free(pOffsets);</span><br><span class="line">    free(pData);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>pEntry-&gt;key.index就是资源的key在资源key字符串池中的序号了,直接打印即可。</p>
<p>然后找到struct ResTable_entry后面跟着的struct Res_value,这个结构体里面就是资源的值。但是这个值的获取比较复杂,我们先来看看这个结构体的定义:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * Representation of a value in a resource, supplying type</span><br><span class="line"> * information.</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">struct</span> Res_value</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Number of bytes in this structure.</span></span><br><span class="line">    <span class="keyword">uint16_t</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Always set to 0.</span></span><br><span class="line">    <span class="keyword">uint8_t</span> res0;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Type of the data value.</span></span><br><span class="line">    <span class="keyword">enum</span> &#123;</span><br><span class="line">        <span class="comment">// The 'data' is either 0 or 1, specifying this resource is either</span></span><br><span class="line">        <span class="comment">// undefined or empty, respectively.</span></span><br><span class="line">        TYPE_NULL = <span class="number">0x00</span>,</span><br><span class="line">        <span class="comment">// The 'data' holds a ResTable_ref, a reference to another resource</span></span><br><span class="line">        <span class="comment">// table entry.</span></span><br><span class="line">        TYPE_REFERENCE = <span class="number">0x01</span>,</span><br><span class="line">        <span class="comment">// The 'data' holds an attribute resource identifier.</span></span><br><span class="line">        TYPE_ATTRIBUTE = <span class="number">0x02</span>,</span><br><span class="line">        <span class="comment">// The 'data' holds an index into the containing resource table's</span></span><br><span class="line">        <span class="comment">// global value string pool.</span></span><br><span class="line">        TYPE_STRING = <span class="number">0x03</span>,</span><br><span class="line">        <span class="comment">// The 'data' holds a single-precision floating point number.</span></span><br><span class="line">        TYPE_FLOAT = <span class="number">0x04</span>,</span><br><span class="line">        <span class="comment">// The 'data' holds a complex number encoding a dimension value,</span></span><br><span class="line">        <span class="comment">// such as "100in".</span></span><br><span class="line">        TYPE_DIMENSION = <span class="number">0x05</span>,</span><br><span class="line">        <span class="comment">// The 'data' holds a complex number encoding a fraction of a</span></span><br><span class="line">        <span class="comment">// container.</span></span><br><span class="line">        TYPE_FRACTION = <span class="number">0x06</span>,</span><br><span class="line">        <span class="comment">// The 'data' holds a dynamic ResTable_ref, which needs to be</span></span><br><span class="line">        <span class="comment">// resolved before it can be used like a TYPE_REFERENCE.</span></span><br><span class="line">        TYPE_DYNAMIC_REFERENCE = <span class="number">0x07</span>,</span><br><span class="line">        <span class="comment">// The 'data' holds an attribute resource identifier, which needs to be resolved</span></span><br><span class="line">        <span class="comment">// before it can be used like a TYPE_ATTRIBUTE.</span></span><br><span class="line">        TYPE_DYNAMIC_ATTRIBUTE = <span class="number">0x08</span>,</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Beginning of integer flavors...</span></span><br><span class="line">        TYPE_FIRST_INT = <span class="number">0x10</span>,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// The 'data' is a raw integer value of the form n..n.</span></span><br><span class="line">        TYPE_INT_DEC = <span class="number">0x10</span>,</span><br><span class="line">        <span class="comment">// The 'data' is a raw integer value of the form 0xn..n.</span></span><br><span class="line">        TYPE_INT_HEX = <span class="number">0x11</span>,</span><br><span class="line">        <span class="comment">// The 'data' is either 0 or 1, for input "false" or "true" respectively.</span></span><br><span class="line">        TYPE_INT_BOOLEAN = <span class="number">0x12</span>,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Beginning of color integer flavors...</span></span><br><span class="line">        TYPE_FIRST_COLOR_INT = <span class="number">0x1c</span>,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// The 'data' is a raw integer value of the form #aarrggbb.</span></span><br><span class="line">        TYPE_INT_COLOR_ARGB8 = <span class="number">0x1c</span>,</span><br><span class="line">        <span class="comment">// The 'data' is a raw integer value of the form #rrggbb.</span></span><br><span class="line">        TYPE_INT_COLOR_RGB8 = <span class="number">0x1d</span>,</span><br><span class="line">        <span class="comment">// The 'data' is a raw integer value of the form #argb.</span></span><br><span class="line">        TYPE_INT_COLOR_ARGB4 = <span class="number">0x1e</span>,</span><br><span class="line">        <span class="comment">// The 'data' is a raw integer value of the form #rgb.</span></span><br><span class="line">        TYPE_INT_COLOR_RGB4 = <span class="number">0x1f</span>,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ...end of integer flavors.</span></span><br><span class="line">        TYPE_LAST_COLOR_INT = <span class="number">0x1f</span>,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ...end of integer flavors.</span></span><br><span class="line">        TYPE_LAST_INT = <span class="number">0x1f</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">uint8_t</span> dataType;</span><br><span class="line">    </span><br><span class="line">     <span class="comment">// Structure of complex data values (TYPE_UNIT and TYPE_FRACTION)</span></span><br><span class="line">    <span class="keyword">enum</span> &#123;</span><br><span class="line">        <span class="comment">// Where the unit type information is.  This gives us 16 possible</span></span><br><span class="line">        <span class="comment">// types, as defined below.</span></span><br><span class="line">        COMPLEX_UNIT_SHIFT = <span class="number">0</span>,</span><br><span class="line">        COMPLEX_UNIT_MASK = <span class="number">0xf</span>,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// TYPE_DIMENSION: Value is raw pixels.</span></span><br><span class="line">        COMPLEX_UNIT_PX = <span class="number">0</span>,</span><br><span class="line">        <span class="comment">// TYPE_DIMENSION: Value is Device Independent Pixels.</span></span><br><span class="line">        COMPLEX_UNIT_DIP = <span class="number">1</span>,</span><br><span class="line">        <span class="comment">// TYPE_DIMENSION: Value is a Scaled device independent Pixels.</span></span><br><span class="line">        COMPLEX_UNIT_SP = <span class="number">2</span>,</span><br><span class="line">        <span class="comment">// TYPE_DIMENSION: Value is in points.</span></span><br><span class="line">        COMPLEX_UNIT_PT = <span class="number">3</span>,</span><br><span class="line">        <span class="comment">// TYPE_DIMENSION: Value is in inches.</span></span><br><span class="line">        COMPLEX_UNIT_IN = <span class="number">4</span>,</span><br><span class="line">        <span class="comment">// TYPE_DIMENSION: Value is in millimeters.</span></span><br><span class="line">        COMPLEX_UNIT_MM = <span class="number">5</span>,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// TYPE_FRACTION: A basic fraction of the overall size.</span></span><br><span class="line">        COMPLEX_UNIT_FRACTION = <span class="number">0</span>,</span><br><span class="line">        <span class="comment">// TYPE_FRACTION: A fraction of the parent size.</span></span><br><span class="line">        COMPLEX_UNIT_FRACTION_PARENT = <span class="number">1</span>,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Where the radix information is, telling where the decimal place</span></span><br><span class="line">        <span class="comment">// appears in the mantissa.  This give us 4 possible fixed point</span></span><br><span class="line">        <span class="comment">// representations as defined below.</span></span><br><span class="line">        COMPLEX_RADIX_SHIFT = <span class="number">4</span>,</span><br><span class="line">        COMPLEX_RADIX_MASK = <span class="number">0x3</span>,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// The mantissa is an integral number -- i.e., 0xnnnnnn.0</span></span><br><span class="line">        COMPLEX_RADIX_23p0 = <span class="number">0</span>,</span><br><span class="line">        <span class="comment">// The mantissa magnitude is 16 bits -- i.e, 0xnnnn.nn</span></span><br><span class="line">        COMPLEX_RADIX_16p7 = <span class="number">1</span>,</span><br><span class="line">        <span class="comment">// The mantissa magnitude is 8 bits -- i.e, 0xnn.nnnn</span></span><br><span class="line">        COMPLEX_RADIX_8p15 = <span class="number">2</span>,</span><br><span class="line">        <span class="comment">// The mantissa magnitude is 0 bits -- i.e, 0x0.nnnnnn</span></span><br><span class="line">        COMPLEX_RADIX_0p23 = <span class="number">3</span>,</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Where the actual value is.  This gives us 23 bits of</span></span><br><span class="line">        <span class="comment">// precision.  The top bit is the sign.</span></span><br><span class="line">        COMPLEX_MANTISSA_SHIFT = <span class="number">8</span>,</span><br><span class="line">        COMPLEX_MANTISSA_MASK = <span class="number">0xffffff</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Possible data values for TYPE_NULL.</span></span><br><span class="line">    <span class="keyword">enum</span> &#123;</span><br><span class="line">        <span class="comment">// The value is not defined.</span></span><br><span class="line">        DATA_NULL_UNDEFINED = <span class="number">0</span>,</span><br><span class="line">        <span class="comment">// The value is explicitly defined as empty.</span></span><br><span class="line">        DATA_NULL_EMPTY = <span class="number">1</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The data for this item, as interpreted according to dataType.</span></span><br><span class="line">    <span class="keyword">typedef</span> <span class="keyword">uint32_t</span> data_type;</span><br><span class="line">    data_type data;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>我们先需要根据dataType判断这个值是什么类型的,然后再根据不同的类型,从data读取具体的值。读取的方法比较复杂,我就不具体讲解,大家可以参考我的demo代码理解。</p>
<p>我们找到bool部分的打印,可以看到key和value就都打印出来了:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">type:</span> id=<span class="number">0x3</span>,name=bool</span><br><span class="line"><span class="number">80</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="string">config :</span></span><br><span class="line"><span class="string">entryIndex:</span> <span class="number">0x0</span>, <span class="string">key :</span></span><br><span class="line">abc_action_bar_embed_tabs</span><br><span class="line"><span class="string">value :</span></span><br><span class="line">(<span class="typename">boolean</span>) <span class="literal">true</span></span><br><span class="line"><span class="label"></span><br><span class="line">entryIndex:</span> <span class="number">0x1</span>, <span class="string">key :</span></span><br><span class="line">abc_allow_stacked_button_bar</span><br><span class="line"><span class="string">value :</span></span><br><span class="line">(<span class="typename">boolean</span>) <span class="literal">false</span></span><br><span class="line"><span class="label"></span><br><span class="line">entryIndex:</span> <span class="number">0x2</span>, <span class="string">key :</span></span><br><span class="line">abc_config_actionMenuItemAllCaps</span><br><span class="line"><span class="string">value :</span></span><br><span class="line">(<span class="typename">boolean</span>) <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="string">config :</span> port</span><br><span class="line"><span class="string">entryIndex:</span> <span class="number">0x0</span>, <span class="string">key :</span></span><br><span class="line">abc_action_bar_embed_tabs</span><br><span class="line"><span class="string">value :</span></span><br><span class="line">(<span class="typename">boolean</span>) <span class="literal">false</span></span><br></pre></td></tr></table></figure>
<h2 id="ResTable_map_entry"><a href="#ResTable_map_entry" class="headerlink" title="ResTable_map_entry"></a>ResTable_map_entry</h2><p>从上面可以看出来ResTable_entry代表的是普通键值对的资源如string、bool、drawable等,那ResTable_map_entry又代表的是啥呢?</p>
<p>其实它代表的是类型style、attr的资源:</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;attr <span class="property">name</span>=<span class="string">"buttonTintMode"</span>&gt;</span><br><span class="line">	&lt;enum <span class="property">name</span>=<span class="string">"src_over"</span> value=<span class="string">"3"</span>/&gt;</span><br><span class="line">	&lt;enum <span class="property">name</span>=<span class="string">"src_in"</span> value=<span class="string">"5"</span>/&gt;</span><br><span class="line">	&lt;enum <span class="property">name</span>=<span class="string">"src_atop"</span> value=<span class="string">"9"</span>/&gt;</span><br><span class="line">	&lt;enum <span class="property">name</span>=<span class="string">"multiply"</span> value=<span class="string">"14"</span>/&gt;</span><br><span class="line">	&lt;enum <span class="property">name</span>=<span class="string">"screen"</span> value=<span class="string">"15"</span>/&gt;</span><br><span class="line">	&lt;enum <span class="property">name</span>=<span class="string">"add"</span> value=<span class="string">"16"</span>/&gt;</span><br><span class="line">&lt;/attr&gt;</span><br><span class="line"></span><br><span class="line">&lt;style <span class="property">name</span>=<span class="string">"AppTheme"</span> parent=<span class="string">"Theme.AppCompat.Light.DarkActionBar"</span>&gt;</span><br><span class="line">        &lt;<span class="property">item</span> <span class="property">name</span>=<span class="string">"colorPrimary"</span>&gt;@color/colorPrimary&lt;/<span class="property">item</span>&gt;</span><br><span class="line">        &lt;<span class="property">item</span> <span class="property">name</span>=<span class="string">"colorPrimaryDark"</span>&gt;@color/colorPrimaryDark&lt;/<span class="property">item</span>&gt;</span><br><span class="line">        &lt;<span class="property">item</span> <span class="property">name</span>=<span class="string">"colorAccent"</span>&gt;@color/colorAccent&lt;/<span class="property">item</span>&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p>像上面的R.attr.buttonTintMode和R.style.AppTheme的值都需要用一个map去表示。</p>
<p>我们来看看struct ResTable_map_entry:</p>
<figure class="highlight mizar"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Extended form <span class="keyword">of</span> a ResTable_entry <span class="keyword">for</span> map entries, defining a parent map</span><br><span class="line"> * resource <span class="keyword">from</span> which to inherit values.</span><br><span class="line"> */</span><br><span class="line"><span class="keyword">struct</span> ResTable_map_entry : public ResTable_entry</span><br><span class="line">&#123;</span><br><span class="line">    // Resource identifier <span class="keyword">of</span> the parent mapping, <span class="keyword">or</span> 0 if there <span class="keyword">is</span> none.</span><br><span class="line">    ResTable_ref parent;</span><br><span class="line">    // Number <span class="keyword">of</span> name/value pairs <span class="keyword">that</span> follow <span class="keyword">for</span> FLAG_COMPLEX.</span><br><span class="line">    uint32_t count;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>它的parent成员变量就定义了这个style的parent,count成员变量则代表了这个map的大小,也就是ResTable_map_entry后面跟着的键值对的数量。</p>
<h3 id="u8D44_u6E90_u7684id"><a href="#u8D44_u6E90_u7684id" class="headerlink" title="资源的id"></a>资源的id</h3><p>struct ResTable_ref也是一个需要重点讲解的结构体,它的定义很简单:</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> *  This <span class="keyword">is</span> <span class="keyword">a reference</span> <span class="keyword">to</span> a unique entry (a ResTable_entry structure)</span><br><span class="line"> *  <span class="keyword">in</span> a resource table.  The value <span class="keyword">is</span> structured <span class="keyword">as</span>: <span class="number">0</span>xpptteeee,</span><br><span class="line"> *  <span class="keyword">where</span> pp <span class="keyword">is</span> <span class="keyword">the</span> package index, tt <span class="keyword">is</span> <span class="keyword">the</span> type index <span class="keyword">in</span> <span class="keyword">that</span></span><br><span class="line"> *  package, <span class="keyword">and</span> eeee <span class="keyword">is</span> <span class="keyword">the</span> entry index <span class="keyword">in</span> <span class="keyword">that</span> type.  The package</span><br><span class="line"> *  <span class="keyword">and</span> type values start <span class="keyword">at</span> <span class="number">1</span> <span class="keyword">for</span> <span class="keyword">the</span> <span class="keyword">first</span> <span class="property">item</span>, <span class="keyword">to</span> help catch cases</span><br><span class="line"> *  <span class="keyword">where</span> they have <span class="keyword">not</span> been supplied.</span><br><span class="line"> */</span><br><span class="line">struct ResTable_ref</span><br><span class="line">&#123;</span><br><span class="line">    uint32_t ident;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>这个ident代表的就是资源的id。这个值其实我们在java里面也能看到:</p>
<figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">R</span> </span>&#123;</span><br><span class="line">	...</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">bool</span> </span>&#123;</span><br><span class="line">	    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> abc_action_bar_embed_tabs=<span class="number">0x7f030000</span>;</span><br><span class="line">	    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> abc_allow_stacked_button_bar=<span class="number">0x7f030001</span>;</span><br><span class="line">	    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> abc_config_actionMenuItemAllCaps=<span class="number">0x7f030002</span>;</span><br><span class="line">	  &#125;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>资源的id其实是有固定的格式和含义的,它的格式如下:</p>
<blockquote>
<p>0xpptteeee</p>
</blockquote>
<p>头一个字节保存了packageId,接着的一个字节保存了typeId,后面的两个字节保存了entryIndex。例如我们的abc_allow_stacked_button_bar=0x7f030001,它的packageId=0x7f, typeId=0x3, entryIndex=0x1。</p>
<p>我们在解析package资源的时候就已经把package id打印了出来,它就是0x7f:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">type</span><span class="pseudo">:512</span>, <span class="tag">headSize</span><span class="pseudo">:288</span>, <span class="tag">size</span><span class="pseudo">:188068</span>, <span class="tag">id</span><span class="pseudo">:7f</span>, <span class="tag">packageName</span><span class="pseudo">:com</span><span class="class">.cvte</span><span class="class">.tv</span><span class="class">.myapplication</span></span><br></pre></td></tr></table></figure>
<p>而在后面解析资源的时候也把typeId和entryIndex打印了出来:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">type: id=<span class="number">0x3</span>,name=<span class="keyword">bool</span></span><br><span class="line"><span class="number">80</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line">config :</span><br><span class="line">entryIndex: <span class="number">0x0</span>, key :</span><br><span class="line">abc_action_bar_embed_tabs</span><br><span class="line">value :</span><br><span class="line">(boolean) <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">entryIndex: <span class="number">0x1</span>, key :</span><br><span class="line">abc_allow_stacked_button_bar</span><br></pre></td></tr></table></figure>
<p>于是乎我们就能定位到abc_allow_stacked_button_bar这个资源了。</p>
<p>所以我们的style的parent.ident就可以定位到style的parent资源。</p>
<p>有时候我们会看到packageId是0x01,在我们的resource.arsc里面找不到对应的package。这个package指定其实是系统资源包,我们在xml里面配置的@android:color/black就会使用到系统资源包里面的资源,这个资源是不会打包进我们的应用的:</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span>: id=<span class="number">0x4</span>,name=col<span class="subst">or</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">...</span></span><br><span class="line"></span><br><span class="line">entryIndex: <span class="number">0x41</span>, key :</span><br><span class="line">primary_dark_material_dark</span><br><span class="line">value :</span><br><span class="line">(reference) <span class="number">0x0106000c</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">...</span></span><br></pre></td></tr></table></figure>
<h3 id="ResTable_map"><a href="#ResTable_map" class="headerlink" title="ResTable_map"></a>ResTable_map</h3><p>ResTable_map_entry后面跟着的键值对数组其实就是一个个的ResTable_map:</p>
<img src="/可能是全网讲最细的安卓resources_arsc解析教程二/2.png">
<p>struct ResTable_map定义如下:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * A single name/value mapping that is part of a complex resource</span><br><span class="line"> * entry.</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">struct</span> ResTable_map</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// The resource identifier defining this mapping's name.  For attribute</span></span><br><span class="line">    <span class="comment">// resources, 'name' can be one of the following special resource types</span></span><br><span class="line">    <span class="comment">// to supply meta-data about the attribute; for all other resource types</span></span><br><span class="line">    <span class="comment">// it must be an attribute resource.</span></span><br><span class="line">    ResTable_ref name;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Special values for 'name' when defining attribute resources.</span></span><br><span class="line">    <span class="keyword">enum</span> &#123;</span><br><span class="line">        <span class="comment">// This entry holds the attribute's type code.</span></span><br><span class="line">        ATTR_TYPE = Res_MAKEINTERNAL(<span class="number">0</span>),</span><br><span class="line"></span><br><span class="line">        <span class="comment">// For integral attributes, this is the minimum value it can hold.</span></span><br><span class="line">        ATTR_MIN = Res_MAKEINTERNAL(<span class="number">1</span>),</span><br><span class="line"></span><br><span class="line">        <span class="comment">// For integral attributes, this is the maximum value it can hold.</span></span><br><span class="line">        ATTR_MAX = Res_MAKEINTERNAL(<span class="number">2</span>),</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Localization of this resource is can be encouraged or required with</span></span><br><span class="line">        <span class="comment">// an aapt flag if this is set</span></span><br><span class="line">        ATTR_L10N = Res_MAKEINTERNAL(<span class="number">3</span>),</span><br><span class="line"></span><br><span class="line">        <span class="comment">// for plural support, see android.content.res.PluralRules#attrForQuantity(int)</span></span><br><span class="line">        ATTR_OTHER = Res_MAKEINTERNAL(<span class="number">4</span>),</span><br><span class="line">        ATTR_ZERO = Res_MAKEINTERNAL(<span class="number">5</span>),</span><br><span class="line">        ATTR_ONE = Res_MAKEINTERNAL(<span class="number">6</span>),</span><br><span class="line">        ATTR_TWO = Res_MAKEINTERNAL(<span class="number">7</span>),</span><br><span class="line">        ATTR_FEW = Res_MAKEINTERNAL(<span class="number">8</span>),</span><br><span class="line">        ATTR_MANY = Res_MAKEINTERNAL(<span class="number">9</span>)</span><br><span class="line"></span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">     <span class="comment">// Bit mask of allowed types, for use with ATTR_TYPE.</span></span><br><span class="line">    <span class="keyword">enum</span> &#123;</span><br><span class="line">        <span class="comment">// No type has been defined for this attribute, use generic</span></span><br><span class="line">        <span class="comment">// type handling.  The low 16 bits are for types that can be</span></span><br><span class="line">        <span class="comment">// handled generically; the upper 16 require additional information</span></span><br><span class="line">        <span class="comment">// in the bag so can not be handled generically for TYPE_ANY.</span></span><br><span class="line">        TYPE_ANY = <span class="number">0x0000FFFF</span>,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Attribute holds a references to another resource.</span></span><br><span class="line">        TYPE_REFERENCE = <span class="number">1</span>&lt;&lt;<span class="number">0</span>,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Attribute holds a generic string.</span></span><br><span class="line">        TYPE_STRING = <span class="number">1</span>&lt;&lt;<span class="number">1</span>,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Attribute holds an integer value.  ATTR_MIN and ATTR_MIN can</span></span><br><span class="line">        <span class="comment">// optionally specify a constrained range of possible integer values.</span></span><br><span class="line">        TYPE_INTEGER = <span class="number">1</span>&lt;&lt;<span class="number">2</span>,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Attribute holds a boolean integer.</span></span><br><span class="line">        TYPE_BOOLEAN = <span class="number">1</span>&lt;&lt;<span class="number">3</span>,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Attribute holds a color value.</span></span><br><span class="line">        TYPE_COLOR = <span class="number">1</span>&lt;&lt;<span class="number">4</span>,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Attribute holds a floating point value.</span></span><br><span class="line">        TYPE_FLOAT = <span class="number">1</span>&lt;&lt;<span class="number">5</span>,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Attribute holds a dimension value, such as "20px".</span></span><br><span class="line">        TYPE_DIMENSION = <span class="number">1</span>&lt;&lt;<span class="number">6</span>,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Attribute holds a fraction value, such as "20%".</span></span><br><span class="line">        TYPE_FRACTION = <span class="number">1</span>&lt;&lt;<span class="number">7</span>,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Attribute holds an enumeration.  The enumeration values are</span></span><br><span class="line">        <span class="comment">// supplied as additional entries in the map.</span></span><br><span class="line">        TYPE_ENUM = <span class="number">1</span>&lt;&lt;<span class="number">16</span>,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Attribute holds a bitmaks of flags.  The flag bit values are</span></span><br><span class="line">        <span class="comment">// supplied as additional entries in the map.</span></span><br><span class="line">        TYPE_FLAGS = <span class="number">1</span>&lt;&lt;<span class="number">17</span></span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Enum of localization modes, for use with ATTR_L10N.</span></span><br><span class="line">    <span class="keyword">enum</span> &#123;</span><br><span class="line">        L10N_NOT_REQUIRED = <span class="number">0</span>,</span><br><span class="line">        L10N_SUGGESTED    = <span class="number">1</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// This mapping's value.</span></span><br><span class="line">    Res_value value;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>它的name代表的就是这个键值对的key,而它的value代表的就是键值对的值。</p>
<p>name同样的是个struct ResTable_ref,它同样可以从资源id拿到对应的资源,但是这个name有点特殊,如果是它的ident的值是下面枚举中的一个的话:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">define</span> Res_MAKEINTERNAL(entry) (<span class="number">0x01000000</span> | (entry&amp;<span class="number">0xFFFF</span>))</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> &#123;</span><br><span class="line">    <span class="comment">// This entry holds the attribute's type code.</span></span><br><span class="line">    ATTR_TYPE = Res_MAKEINTERNAL(<span class="number">0</span>),</span><br><span class="line"></span><br><span class="line">    <span class="comment">// For integral attributes, this is the minimum value it can hold.</span></span><br><span class="line">    ATTR_MIN = Res_MAKEINTERNAL(<span class="number">1</span>),</span><br><span class="line"></span><br><span class="line">    <span class="comment">// For integral attributes, this is the maximum value it can hold.</span></span><br><span class="line">    ATTR_MAX = Res_MAKEINTERNAL(<span class="number">2</span>),</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Localization of this resource is can be encouraged or required with</span></span><br><span class="line">    <span class="comment">// an aapt flag if this is set</span></span><br><span class="line">    ATTR_L10N = Res_MAKEINTERNAL(<span class="number">3</span>),</span><br><span class="line"></span><br><span class="line">    <span class="comment">// for plural support, see android.content.res.PluralRules#attrForQuantity(int)</span></span><br><span class="line">    ATTR_OTHER = Res_MAKEINTERNAL(<span class="number">4</span>),</span><br><span class="line">    ATTR_ZERO = Res_MAKEINTERNAL(<span class="number">5</span>),</span><br><span class="line">    ATTR_ONE = Res_MAKEINTERNAL(<span class="number">6</span>),</span><br><span class="line">    ATTR_TWO = Res_MAKEINTERNAL(<span class="number">7</span>),</span><br><span class="line">    ATTR_FEW = Res_MAKEINTERNAL(<span class="number">8</span>),</span><br><span class="line">    ATTR_MANY = Res_MAKEINTERNAL(<span class="number">9</span>)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>例如如果index==0x01000000,就代表name是ATTR_TYPE,也代表这个资源是attr。</p>
<p>此时,它的value也是特殊的,是下面枚举中的一个,代表attr的类型:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> &#123;</span><br><span class="line">    <span class="comment">// No type has been defined for this attribute, use generic</span></span><br><span class="line">    <span class="comment">// type handling.  The low 16 bits are for types that can be</span></span><br><span class="line">    <span class="comment">// handled generically; the upper 16 require additional information</span></span><br><span class="line">    <span class="comment">// in the bag so can not be handled generically for TYPE_ANY.</span></span><br><span class="line">    TYPE_ANY = <span class="number">0x0000FFFF</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Attribute holds a references to another resource.</span></span><br><span class="line">    TYPE_REFERENCE = <span class="number">1</span>&lt;&lt;<span class="number">0</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Attribute holds a generic string.</span></span><br><span class="line">    TYPE_STRING = <span class="number">1</span>&lt;&lt;<span class="number">1</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Attribute holds an integer value.  ATTR_MIN and ATTR_MIN can</span></span><br><span class="line">    <span class="comment">// optionally specify a constrained range of possible integer values.</span></span><br><span class="line">    TYPE_INTEGER = <span class="number">1</span>&lt;&lt;<span class="number">2</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Attribute holds a boolean integer.</span></span><br><span class="line">    TYPE_BOOLEAN = <span class="number">1</span>&lt;&lt;<span class="number">3</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Attribute holds a color value.</span></span><br><span class="line">    TYPE_COLOR = <span class="number">1</span>&lt;&lt;<span class="number">4</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Attribute holds a floating point value.</span></span><br><span class="line">    TYPE_FLOAT = <span class="number">1</span>&lt;&lt;<span class="number">5</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Attribute holds a dimension value, such as "20px".</span></span><br><span class="line">    TYPE_DIMENSION = <span class="number">1</span>&lt;&lt;<span class="number">6</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Attribute holds a fraction value, such as "20%".</span></span><br><span class="line">    TYPE_FRACTION = <span class="number">1</span>&lt;&lt;<span class="number">7</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Attribute holds an enumeration.  The enumeration values are</span></span><br><span class="line">    <span class="comment">// supplied as additional entries in the map.</span></span><br><span class="line">    TYPE_ENUM = <span class="number">1</span>&lt;&lt;<span class="number">16</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Attribute holds a bitmaks of flags.  The flag bit values are</span></span><br><span class="line">    <span class="comment">// supplied as additional entries in the map.</span></span><br><span class="line">    TYPE_FLAGS = <span class="number">1</span>&lt;&lt;<span class="number">17</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>解析代码如下:</p>
<figure class="highlight ocaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(pEntry-&gt;flags &amp; <span class="type">ResTable_entry</span>::<span class="type">FLAG_COMPLEX</span>) &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="type">ResTable_map_entry</span>* pMapEntry = (<span class="keyword">struct</span> <span class="type">ResTable_map_entry</span>*)(pData + offset);</span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">int</span> i = <span class="number">0</span>; i &lt;pMapEntry-&gt;count ; i++) &#123;</span><br><span class="line">        <span class="keyword">struct</span> <span class="type">ResTable_map</span>* pMap = (<span class="keyword">struct</span> <span class="type">ResTable_map</span>*)(pData + offset + pMapEntry-&gt;size + i * sizeof(<span class="keyword">struct</span> <span class="type">ResTable_map_entry</span>));</span><br><span class="line">        printf(<span class="string">"\tname:0x%x, valueType:%u, value:%u\n"</span>, pMap-&gt;name.ident, pMap-&gt;<span class="keyword">value</span>.dataType, pMap-&gt;<span class="keyword">value</span>.data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>让我们找到buttonTintMode的打印</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">entryIndex</span>: <span class="number">0</span>x69, <span class="attribute">key </span>:</span><br><span class="line">buttonTintMode</span><br><span class="line">    <span class="attribute">name</span>:<span class="number">0</span>x1000000, <span class="attribute">valueType</span>:<span class="number">16</span>, <span class="attribute">value</span>:<span class="number">65536</span></span><br><span class="line">    <span class="attribute">name</span>:<span class="number">0</span>x7f070019, <span class="attribute">valueType</span>:<span class="number">16</span>, <span class="attribute">value</span>:<span class="number">16</span></span><br><span class="line">    <span class="attribute">name</span>:<span class="number">0</span>x7f070050, <span class="attribute">valueType</span>:<span class="number">16</span>, <span class="attribute">value</span>:<span class="number">14</span></span><br><span class="line">    <span class="attribute">name</span>:<span class="number">0</span>x7f070061, <span class="attribute">valueType</span>:<span class="number">16</span>, <span class="attribute">value</span>:<span class="number">15</span></span><br><span class="line">    <span class="attribute">name</span>:<span class="number">0</span>x7f070078, <span class="attribute">valueType</span>:<span class="number">16</span>, <span class="attribute">value</span>:<span class="number">9</span></span><br><span class="line">    <span class="attribute">name</span>:<span class="number">0</span>x7f070079, <span class="attribute">valueType</span>:<span class="number">16</span>, <span class="attribute">value</span>:<span class="number">5</span></span><br><span class="line">    <span class="attribute">name</span>:<span class="number">0</span>x7f07007a, <span class="attribute">valueType</span>:<span class="number">16</span>, <span class="attribute">value</span>:<span class="number">3</span></span><br></pre></td></tr></table></figure>
<p>第一个ResTable_ref的name的indent的值是0x1000000,就代表name是ATTR_TYPE,也代表这个资源是attr。然后value是65536,也就是TYPE_ENUM。</p>
<p>然后我们顺便找下7f070019、7f070050、7f070061、7f070078、7f070079、7f07007a资源的定义:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="label"></span><br><span class="line">type:</span> id=<span class="number">0x7</span>,name=id</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="label"></span><br><span class="line">entryIndex:</span> <span class="number">0x19</span>, <span class="string">key :</span></span><br><span class="line">add</span><br><span class="line"><span class="string">value :</span></span><br><span class="line">(<span class="typename">boolean</span>) <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="label"></span><br><span class="line">entryIndex:</span> <span class="number">0x50</span>, <span class="string">key :</span></span><br><span class="line">multiply</span><br><span class="line"><span class="string">value :</span></span><br><span class="line">(<span class="typename">boolean</span>) <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="label"></span><br><span class="line">entryIndex:</span> <span class="number">0x61</span>, <span class="string">key :</span></span><br><span class="line">screen</span><br><span class="line"><span class="string">value :</span></span><br><span class="line">(<span class="typename">boolean</span>) <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="label"></span><br><span class="line">entryIndex:</span> <span class="number">0x78</span>, <span class="string">key :</span></span><br><span class="line">src_atop</span><br><span class="line"><span class="string">value :</span></span><br><span class="line">(<span class="typename">boolean</span>) <span class="literal">false</span></span><br><span class="line"><span class="label"></span><br><span class="line">entryIndex:</span> <span class="number">0x79</span>, <span class="string">key :</span></span><br><span class="line">src_in</span><br><span class="line"><span class="string">value :</span></span><br><span class="line">(<span class="typename">boolean</span>) <span class="literal">false</span></span><br><span class="line"><span class="label"></span><br><span class="line">entryIndex:</span> <span class="number">0x7a</span>, <span class="string">key :</span></span><br><span class="line">src_over</span><br><span class="line"><span class="string">value :</span></span><br><span class="line">(<span class="typename">boolean</span>) <span class="literal">false</span></span><br></pre></td></tr></table></figure>
<h1 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h1><p>完整的demo可以在github上找到:</p>
<p><a href="https://github.com/bluesky466/ResourcesArscDemo" target="_blank" rel="external">https://github.com/bluesky466/ResourcesArscDemo</a></p>
<p>呼~长舒一口气,终于大功告成。</p>

    
  </div>
</article>


   

   
  <div class="box-prev-next clearfix">
    <a class="show pull-left" href="/2019/05/18/可能是全网讲最细的安卓resources-arsc解析教程-一/">
        <i class="icon icon-angle-left"></i>
    </a>
    <a class="show pull-right" href="/2019/06/22/binder机制深入探究/">
        <i class="icon icon-angle-right"></i>
    </a>
  </div>




</div>


  <a id="backTop" class="back-top">
    <i class="icon-angle-up"></i>
  </a>




  <div class="modal" id="modal">
  <span id="cover" class="cover hide"></span>
  <div id="modal-dialog" class="modal-dialog hide-dialog">
    <div class="modal-header">
      <span id="close" class="btn-close">关闭</span>
    </div>
    <hr>
    <div class="modal-body">
      <ul class="list-toolbox">
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/archives/"
              rel="noopener noreferrer"
              target="_self"
              >
              博客
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/tag/"
              rel="noopener noreferrer"
              target="_self"
              >
              标签
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/link/"
              rel="noopener noreferrer"
              target="_self"
              >
              友链
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/about/"
              rel="noopener noreferrer"
              target="_self"
              >
              关于
            </a>
          </li>
        
      </ul>

    </div>
  </div>
</div>



  
      <div class="fexo-comments comments-post">
    
  <section class="disqus-comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
  </section>

  <script>
    var disqus_shortname = 'forsigner';
    
    var disqus_url = 'http://139.199.4.241/2019/05/21/可能是全网讲最细的安卓resources-arsc解析教程-二/';
    
    (function(){
      var dsq = document.createElement('script');
      dsq.type = 'text/javascript';
      dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>

  <script id="dsq-count-scr" src="//forsigner.disqus.com/count.js" async></script>



    




    

  </div>

  

  <script type="text/javascript">
  function loadScript(url, callback) {
    var script = document.createElement('script')
    script.type = 'text/javascript';

    if (script.readyState) { //IE
      script.onreadystatechange = function() {
        if (script.readyState == 'loaded' ||
          script.readyState == 'complete') {
          script.onreadystatechange = null;
          callback();
        }
      };
    } else { //Others
      script.onload = function() {
        callback();
      };
    }

    script.src = url;
    document.getElementsByTagName('head')[0].appendChild(script);
  }

  window.onload = function() {
    loadScript('/js/bundle.js?235683', function() {
      // load success
    });
  }
</script>

</body>
</html>
